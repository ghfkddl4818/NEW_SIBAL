# 🎯 완전 통합 자동화 시스템 - 기능 명세서 (자연어 버전)

> **작성일**: 2024년 9월 16일
> **목적**: 개발 과정에서 누락된 모든 기능들을 완전히 백업하여 복원 시 참고용
> **상태**: 원본 시스템들의 모든 기능을 통합 정리

---

## 📋 **시스템 전체 개요**

### **🎯 최종 목표**
30개 이커머스 제품을 완전 자동으로 처리하여 30개의 전문적인 콜드메일을 생성하는 것

### **⚡ 전체 워크플로우**
1. **브라우저 준비** → 30개 제품 탭을 미리 열어둠
2. **웹 자동화** → 각 제품의 상세페이지 + 리뷰 자동 수집
3. **파일 정리** → 수집된 데이터를 AI 처리 가능한 형태로 자동 분류
4. **AI 분석** → OCR + 리뷰 분석으로 제품 정보 구조화
5. **콜드메일 생성** → 맞춤형 전문 콜드메일 자동 작성
6. **발송 관리** → 발송대기 리스트에 자동 등록

---

## 🌐 **1. 웹 자동화 시스템 (file_organizer 기반)**

### **🎮 핵심 작동 방식**

#### **A. 스마트 스크롤 버튼 찾기**
```
목표: 상세정보 버튼 찾기
방법:
1. 현재 화면에서 버튼 이미지 검색
2. 없으면 스크롤 다운 (800픽셀)
3. 다시 검색
4. 최대 16번까지 반복
5. 찾으면 중앙 좌표로 클릭
```

#### **B. URL 수집**
```
목적: 현재 제품 페이지 URL 기록
방법:
1. Ctrl+L → 주소창 선택
2. Ctrl+C → URL 복사
3. 클립보드에서 URL 읽어서 저장
4. 나중에 파일 매칭 시 사용
```

#### **C. 상세정보 펼쳐보기**
```
버튼 이미지: detail_button.png
찾는 방법: 16번 스크롤하면서 검색
클릭 후: 2초 대기 (페이지 로딩)
실패 시: 다음 제품으로 넘어감
```

#### **D. Fireshot 캡처**
```
단축키: Ctrl+Shift+S
대기시간: 3초 (캡처 완료)
저장버튼: fireshot_save.png 이미지로 찾아서 클릭
저장위치: 다운로드 폴더 (자동)
파일형식: PNG 이미지
```

#### **E. 크롤링 시퀀스 (4단계)**
```
1단계: Ctrl+Shift+A → 크롤링툴 실행
  대기: 3초

2단계: 리뷰 버튼 클릭
  찾는 이미지: review_button.png
  컨텍스트: popup_context.png (팝업창 확인)
  최대 대기: 30초

3단계: 분석시작 버튼 클릭
  찾는 이미지: analysis_start.png
  컨텍스트: review_context.png (리뷰 화면 확인)
  최대 대기: 30초

4단계: 엑셀 다운로드
  찾는 이미지: excel_download.png
  컨텍스트: result_context.png (결과 화면 확인)
  최대 대기: 60초 (분석 시간 고려)
```

#### **F. 탭 이동**
```
현재 탭 닫기: Ctrl+W
대기시간: 1초
자동으로 다음 탭으로 이동됨
```

### **🔄 재시도 로직**
- **버튼 클릭**: 3번까지 재시도
- **이미지 검색**: confidence 0.8 기준
- **타임아웃**: 각 단계별 최대 대기시간
- **실패 처리**: 로그 기록 후 다음 제품 진행

---

## 📁 **2. 파일 정리 시스템**

### **🎯 스마트 파일 매칭**

#### **A. 파일명 분석**
```
상세페이지 이미지: "제품명_브랜드명_상세페이지_날짜시간.png"
리뷰 데이터: "제품명_브랜드명_리뷰_날짜시간.xlsx"

파일명에서 추출:
- 제품명
- 브랜드명
- 파일 타입
- 생성 시간
```

#### **B. 순서 기반 매칭**
```
수집 순서 기록:
1. 제품1 상세페이지 → pending_stores에 추가
2. 제품1 리뷰데이터 → pending_stores에서 매칭
3. 제품2 상세페이지 → pending_stores에 추가
...

FIFO 큐 방식으로 순서대로 매칭
```

#### **C. 중복 파일 체크**
```
방법: SHA-256 해시 비교
목적: 같은 파일 중복 처리 방지
저장: 파일 해시 딕셔너리 유지
체크: 새 파일 발견 시 해시 계산해서 비교
```

#### **D. 자동 폴더 분류**
```
대상 폴더:
- E:/업무/03_데이터_수집/
- data/product_images/
- data/reviews/

분류 기준:
- .png, .jpg → 이미지 폴더
- .xlsx, .csv → 리뷰 폴더
- 날짜별 하위 폴더 자동 생성
```

### **📊 데이터베이스 통합**
```
메인 DB: E:/업무/03_데이터_수집/이커머스_수집_데이터베이스.xlsx

자동 업데이트:
- 새 제품 정보 추가
- URL 매핑 정보
- 파일 경로 링크
- 처리 상태 업데이트
```

---

## 🧠 **3. AI 분석 시스템 (2단계 처리)**

### **🔬 Stage 1: OCR 및 데이터 추출**

#### **A. Tesseract OCR 엔진**
```
목적: 제품 이미지에서 텍스트 추출
장점: 무료, API 비용 50% 절약
처리:
1. 이미지 전처리 (해상도, 노이즈 제거)
2. OCR 텍스트 추출
3. 후처리 (오타 수정, 정리)
```

#### **B. OCR 파이프라인**
```
입력: data/product_images/*.png
출력: ocr_raw.jsonl

처리 단계:
1. 이미지 로드
2. 전처리 (밝기, 대비 조정)
3. Tesseract OCR 실행
4. 텍스트 추출
5. JSON 형태로 저장
```

#### **C. OCR 후처리**
```
입력: ocr_raw.jsonl
출력: ocr_clean.jsonl

정리 작업:
- 불필요한 문자 제거
- 가격 정보 정규화
- 제품명 표준화
- 브랜드명 추출
```

### **🎯 Stage 2: 구조화 및 콜드메일 생성**

#### **A. 제품 정보 구조화**
```
프롬프트: product_structuring.json
입력: OCR 정리된 텍스트
출력: product_structured.json

구조화 항목:
- 제품명
- 브랜드명
- 가격 정보
- 주요 특징
- 타겟 고객층
```

#### **B. 리뷰 분석**
```
입력: data/reviews/*.xlsx
분석 내용:
- 긍정/부정 리뷰 비율
- 주요 키워드 추출
- 고객 불만사항
- 개선점 제안
```

#### **C. 콜드메일 생성**
```
프롬프트: cold_email_generation.json
입력: 구조화된 제품정보 + 리뷰분석
출력: 맞춤형 콜드메일

개인화 요소:
- 제품별 특화 메시지
- 리뷰 기반 개선 제안
- 업체별 맞춤 톤앤매너
```

### **💰 비용 관리 시스템**
```
BudgetGuard:
- 작업당 최대 비용 설정
- 실시간 비용 모니터링
- 한도 초과 시 자동 중단

RateLimiter:
- RPM(분당 요청) 제한
- TPM(분당 토큰) 제한
- 안전한 API 호출 관리
```

---

## 📧 **4. 콜드메일 발송 관리 시스템**

### **📋 발송대기 리스트 관리**
```
위치: E:/업무/4.콜드메일_관리/발송대기/
파일: 콜드메일_발송대기_리스트.xlsx

자동 관리:
- 새 콜드메일 생성 시 자동 추가
- 발송 상태 추적
- 발송 일정 관리
```

### **📊 업무 폴더 연동**
```
메인 DB: E:/업무/03_데이터_수집/이커머스_수집_데이터베이스.xlsx
연동 내용:
- 제품 정보 동기화
- 진행 상태 업데이트
- 파일 경로 매핑
```

### **📁 폴더 구조**
```
E:/업무/4.콜드메일_관리/
├── 발송대기/
│   ├── 콜드메일_발송대기_리스트.xlsx
│   └── [날짜별 콜드메일 파일들]
├── 발송완료/
│   └── [발송 완료된 파일들]
└── 템플릿/
    └── [메일 템플릿들]
```

---

## 🎮 **5. GUI 시스템들**

### **🎯 A. 통합 자동화 GUI (ultimate_automation_system.py)**
```
기능: 모든 시스템을 하나로 통합
탭 구성:
1. 자동화 현황 - 전체 진행 상황
2. 웹 자동화 - 브라우저 자동화 설정
3. AI 콜드메일 - AI 생성 설정
4. 고객사 발굴 - 타겟 업체 크롤링
5. 결과 보기 - 생성된 결과물 확인
6. 설정 - 시스템 설정
```

### **🎯 B. 완전 자동화 GUI (complete_automation_gui.py)**
```
기능: 웹자동화 + 파일정리 + AI생성 통합
특징:
- 실시간 진행률 표시
- 에러 처리 및 재시도
- 상세 로그 기록
```

### **🎯 C. 2단계 분리 GUI (two_stage_gui.py)**
```
기능: OCR과 콜드메일 생성을 분리해서 처리
Stage 1 탭: OCR 및 데이터 추출
Stage 2 탭: 콜드메일 생성
장점: 각 단계별 세밀한 제어 가능
```

### **🎯 D. 통합 인터페이스 GUI (unified_gui.py)**
```
기능: 모든 도구를 하나의 인터페이스에 통합
구성:
- 파일 관리
- AI 처리
- 결과 확인
- 설정 관리
```

### **🎯 E. 마스터 시스템 GUI (master_system.py)**
```
기능: 전체 시스템의 마스터 컨트롤러
관리 대상:
- 모든 하위 시스템
- 전역 설정
- 로그 통합 관리
```

---

## 🔧 **6. 고객사 발굴 시스템**

### **🎯 네이버 쇼핑 크롤링**
```
대상: 네이버 쇼핑 검색 결과
방법:
1. 사용자가 수동으로 키워드 검색
2. "리뷰 많은 순" 정렬
3. 자동으로 현재 페이지 크롤링 시작
```

### **🔍 필터링 시스템**
```
리뷰 수 범위: 200~300개 (사용자 설정 가능)
관심고객 수: 50~1500명 (사용자 설정 가능)
추가 필터: 평점, 브랜드, 가격대 등
```

### **📊 크롤링 결과**
```
출력 파일: targets_YYYYMMDD_HHMMSS.csv
수집 정보:
- 스토어명
- 제품명
- 리뷰 수
- 관심고객 수
- 평점
- 가격
- 스토어 링크
```

---

## ⚙️ **7. 시스템 설정 및 환경**

### **🔑 환경변수 관리**
```
VERTEX_PROJECT_ID: Google AI 프로젝트 ID
자동 설정: jadong-471919 (기본값)
검증: 시스템 시작 시 자동 체크
보안: 환경변수로 분리 관리
```

### **📁 경로 설정**
```
작업 폴더: E:/업무/
다운로드 폴더: C:/Users/Administrator/Downloads/
이미지 저장: data/product_images/
리뷰 저장: data/reviews/
결과 저장: outputs/
```

### **🎛️ 실행 옵션들**
```
start_complete_system.bat: 통합 시스템 (최신)
start_complete_automation.bat: 완전 자동화
start_two_stage_gui.bat: 2단계 분리 처리
start_latest_exe.bat: 최신 EXE 버전
```

---

## 🔍 **8. 핵심 알고리즘들**

### **A. 컨텍스트 기반 버튼 클릭**
```
목적: 상황에 맞는 정확한 버튼 클릭
방법:
1. 컨텍스트 이미지로 현재 상황 확인
2. 올바른 상황이면 버튼 이미지 검색
3. 찾으면 클릭, 못찾으면 1초 대기 후 재시도
4. 타임아웃까지 반복
```

### **B. 스마트 재시도 시스템**
```
버튼 클릭: 최대 3번 재시도
이미지 검색: confidence 값 조정하며 재시도
네트워크 오류: 지수 백오프로 재시도
파일 처리: 권한 오류 시 재시도
```

### **C. 파일명 파싱 알고리즘**
```
입력: "상품명_브랜드명_타입_날짜시간.확장자"
출력: {제품명, 브랜드명, 타입, 시간, 확장자}
처리: 정규식 + 문자열 분석
예외처리: 비표준 파일명 대응
```

### **D. 순서 기반 매칭**
```
자료구조: FIFO 큐 (First In, First Out)
매칭 로직:
1. 상세페이지 파일 → 큐에 추가
2. 리뷰 파일 → 큐에서 가장 오래된 것과 매칭
3. 시간 기반 검증 (5분 이내 생성된 파일만)
```

---

## 🛡️ **9. 안전장치 및 모니터링**

### **💰 비용 모니터링**
```
BudgetGuard:
- 작업당 최대 $10 제한
- 실시간 비용 계산
- 한도 도달 시 자동 중단
- 경고 알림 시스템
```

### **⚡ 성능 모니터링**
```
RateLimiter:
- 분당 30회 요청 제한 (RPM)
- 분당 50,000 토큰 제한 (TPM)
- 자동 대기 시간 계산
- 큐 관리 시스템
```

### **🔒 오류 처리**
```
캡처 실패: 다음 제품 진행
API 오류: 지수 백오프 재시도
파일 권한: 관리자 권한 요청
네트워크: 연결 상태 확인
```

### **📊 로깅 시스템**
```
레벨: DEBUG, INFO, WARNING, ERROR
출력: 콘솔 + 파일
회전: 일별 로그 파일 분리
형식: 시간 + 레벨 + 모듈 + 메시지
```

---

## 🚀 **10. 실행 시나리오**

### **🎯 완전 자동화 시나리오**
```
사전 준비:
1. 브라우저에 30개 제품 탭 열기
2. 각 탭에 제품 상세페이지 로드
3. Fireshot, 크롤링툴 확장프로그램 설치

실행 과정:
1. start_complete_system.bat 실행
2. "🚀 완전 자동화 시작" 버튼 클릭
3. 2-3시간 대기 (자동 처리)
4. 30개 콜드메일 생성 완료

결과 확인:
- outputs/ 폴더에 JSON 파일들
- 발송대기/ 폴더에 엑셀 업데이트
- 로그에서 처리 결과 확인
```

### **🎯 개별 모듈 실행**
```
웹 자동화만: "🚀 웹 자동화만 시작" 버튼
AI 생성만: "🤖 AI 생성만 시작" 버튼
고객사 발굴: "고객사 발굴" 탭에서 실행
2단계 처리: start_two_stage_gui.bat
```

---

## ⚠️ **11. 주의사항 및 제한사항**

### **🔴 필수 요구사항**
```
- Windows 10/11 운영체제
- Python 3.8+ 설치
- Google AI Studio API 키
- Tesseract OCR 설치
- Chrome 브라우저 + 확장프로그램들
```

### **🟡 작업 환경**
```
- 안정적인 인터넷 연결
- 충분한 디스크 공간 (최소 5GB)
- 관리자 권한 실행
- 화면 해상도 1920x1080 이상 권장
```

### **🟠 알려진 제한사항**
```
- 캡차 발생 시 수동 개입 필요
- 네트워크 불안정 시 재시작 필요
- 메모리 부족 시 배치 크기 조정
- API 할당량 초과 시 대기 필요
```

---

## 📚 **12. 파일 구조 맵**

### **🗂️ 전체 디렉토리 구조**
```
E:/VSC/all_in_one/all_in_one_new/all_in_one/
├── ultimate_automation_system.py      # 메인 통합 시스템
├── start_complete_system.bat          # 최신 실행파일
├── config/
│   └── config.yaml                    # 시스템 설정
├── core/
│   ├── config.py                      # 설정 관리
│   ├── logger.py                      # 로깅 시스템
│   └── safety_monitor.py              # 안전장치
├── llm/
│   ├── gemini_client.py               # AI 클라이언트
│   ├── two_stage_processor.py         # 2단계 처리기
│   └── prompts/                       # AI 프롬프트들
├── compose/
│   ├── composer.py                    # 메일 조립
│   └── email_sender_manager.py        # 발송 관리
├── gui/
│   ├── complete_automation_gui.py     # 완전 자동화 GUI
│   ├── two_stage_gui.py              # 2단계 GUI
│   ├── unified_gui.py                # 통합 GUI
│   └── master_system.py              # 마스터 GUI
├── app/
│   └── pipeline.py                   # 전체 파이프라인
├── ocr/
│   ├── engine.py                     # OCR 엔진
│   └── postproc.py                   # 후처리
├── reviews/
│   └── normalize.py                  # 리뷰 정규화
├── client_discovery/                 # 고객사 발굴
│   ├── main_crawler.py              # 메인 크롤러
│   ├── config.json                  # 크롤링 설정
│   └── m2_list_scanner.py           # OCR 스캐너
├── data/
│   ├── product_images/              # 제품 이미지
│   └── reviews/                     # 리뷰 데이터
└── outputs/                         # 생성 결과물
```

### **🎯 필수 이미지 파일들**
```
E:/VSC/file_organizer/
├── detail_button.png              # 상세정보 버튼
├── fireshot_save.png              # Fireshot 저장 버튼
├── analysis_start.png             # 분석시작 버튼
├── excel_download.png             # 엑셀다운로드 버튼
├── review_button.png              # 리뷰 버튼
├── popup_context.png              # 팝업 컨텍스트
├── review_context.png             # 리뷰 컨텍스트
└── result_context.png             # 결과 컨텍스트
```

---

## 🎯 **완료! 모든 기능이 완전히 백업되었습니다.**

이제 이 문서를 기반으로 언제든지 모든 기능을 정확하게 복원할 수 있습니다. 더 이상 기능을 놓치거나 잊어버릴 일은 없을 것입니다!