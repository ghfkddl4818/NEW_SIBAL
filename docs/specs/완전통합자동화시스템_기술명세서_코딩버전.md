# ğŸ”§ ì™„ì „ í†µí•© ìë™í™” ì‹œìŠ¤í…œ - ê¸°ìˆ  ëª…ì„¸ì„œ (ì½”ë”© ë²„ì „)

> **ì‘ì„±ì¼**: 2024ë…„ 9ì›” 16ì¼
> **ëª©ì **: ê°œë°œìë¥¼ ìœ„í•œ ìƒì„¸ ê¸°ìˆ  ì‚¬ì–‘ ë° êµ¬í˜„ ê°€ì´ë“œ
> **ëŒ€ìƒ**: ì‹œìŠ¤í…œ ë³µì›/ê°œë°œ ì‹œ ì°¸ê³ ìš©

---

## ğŸ—ï¸ **ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜**

### **ğŸ“Š ì „ì²´ êµ¬ì¡°ë„**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 GUI Layer                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚              Business Logic                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚           External Integrations             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚              Data Storage                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **ğŸ”— ëª¨ë“ˆ ì˜ì¡´ì„±**
```python
ultimate_automation_system.py
â”œâ”€â”€ core.config
â”œâ”€â”€ llm.gemini_client
â”œâ”€â”€ compose.composer
â”œâ”€â”€ pyautogui, pyperclip
â””â”€â”€ tkinter (GUI)

complete_automation_gui.py
â”œâ”€â”€ llm.two_stage_processor
â”œâ”€â”€ core.config
â””â”€â”€ tkinter

two_stage_processor.py
â”œâ”€â”€ llm.gemini_client
â”œâ”€â”€ compose.email_sender_manager
â””â”€â”€ loguru

client_discovery/
â”œâ”€â”€ main_crawler.py
â”œâ”€â”€ m2_list_scanner.py
â””â”€â”€ config.json
```

---

## ğŸŒ **ì›¹ ìë™í™” ëª¨ë“ˆ (file_organizer ê¸°ë°˜)**

### **ğŸ¯ í•µì‹¬ í´ë˜ìŠ¤: FileOrganizerGUI**

```python
class FileOrganizerGUI:
    def __init__(self):
        # í´ë” ê²½ë¡œ ì„¤ì •
        self.download_folder = Path("C:/Users/Administrator/Downloads")
        self.work_folder = Path("E:/ì—…ë¬´")
        self.database_file = Path("E:/ì—…ë¬´/03_ë°ì´í„°_ìˆ˜ì§‘/ì´ì»¤ë¨¸ìŠ¤_ìˆ˜ì§‘_ë°ì´í„°ë² ì´ìŠ¤.xlsx")

        # ì›¹ ìë™í™” ìƒíƒœ
        self.automation_running = False
        self.automation_paused = False
        self.processed_count = 0
        self.failed_products = []
        self.total_products = 30

        # ì¤‘ë³µ ì²´í¬ìš© í•´ì‹œ ë”•ì…”ë„ˆë¦¬
        self.file_hashes = {}

        # ìˆœì„œ ê¸°ë°˜ ë§¤ì¹­ìš© FIFO í
        self.pending_stores = []  # [(ìŠ¤í† ì–´ëª…, íŒŒì¼ì²˜ë¦¬ì‹œê°„), ...]
```

### **ğŸ”„ ë©”ì¸ ìë™í™” ë£¨í”„**

```python
def run_automation(self):
    """ìë™í™” ë©”ì¸ ë£¨í”„"""
    self.automation_running = True
    self.automation_button.config(text="â¸ï¸ ìë™í™” ì‹¤í–‰ ì¤‘...", state="disabled")

    try:
        self.update_status("ì›¹ ìë™í™” ì‹œì‘ - 3ì´ˆ í›„ ì‹œì‘í•©ë‹ˆë‹¤...")
        time.sleep(3)

        for i in range(self.total_products):
            if not self.automation_running:  # ESCë¡œ ì¤‘ë‹¨ëœ ê²½ìš°
                break

            self.update_status(f"ì œí’ˆ {i+1}/{self.total_products} ì²˜ë¦¬ ì¤‘...")

            success = self.process_single_product(i + 1)

            if success:
                self.processed_count += 1
            else:
                self.failed_products.append(i + 1)

            self.update_progress()

            # ë‹¤ìŒ íƒ­ìœ¼ë¡œ ì´ë™ (ë§ˆì§€ë§‰ ì œí’ˆì´ ì•„ë‹Œ ê²½ìš°ë§Œ)
            if i < self.total_products - 1:
                pyautogui.hotkey('ctrl', 'w')  # í˜„ì¬ íƒ­ ë‹«ê¸°
                time.sleep(1)

    except Exception as e:
        messagebox.showerror("ì˜¤ë¥˜", f"ìë™í™” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: {e}")

    finally:
        self.automation_complete()
```

### **ğŸ® ë‹¨ì¼ ì œí’ˆ ì²˜ë¦¬ ë¡œì§**

```python
def process_single_product(self, product_index):
    """ë‹¨ì¼ ì œí’ˆ ì²˜ë¦¬"""
    try:
        # 1. URL ìˆ˜ì§‘
        url = self.collect_current_url()
        if not url:
            return False

        # 2. ìƒì„¸ì •ë³´ í¼ì³ë³´ê¸°
        if not self.expand_product_details():
            return False

        # 3. íŒŒì´ì–´ìƒ· ìº¡ì²˜
        if not self.capture_with_fireshot():
            return False

        # 4. í¬ë¡¤ë§ ì‹œí€€ìŠ¤
        if not self.crawling_sequence():
            return False

        # 5. ë°ì´í„°ë² ì´ìŠ¤ ê¸°ë¡ (URLê³¼ í•¨ê»˜)
        self.record_product_url(url, product_index)

        return True

    except Exception as e:
        print(f"ì œí’ˆ {product_index} ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜: {e}")
        return False
```

### **ğŸ“‹ URL ìˆ˜ì§‘**

```python
def collect_current_url(self):
    """í˜„ì¬ íƒ­ì˜ URL ìˆ˜ì§‘"""
    try:
        pyautogui.hotkey('ctrl', 'l')  # ì£¼ì†Œì°½ ì„ íƒ
        time.sleep(0.5)
        pyautogui.hotkey('ctrl', 'c')  # URL ë³µì‚¬
        time.sleep(0.5)
        url = pyperclip.paste()
        print(f"URL ìˆ˜ì§‘ ì™„ë£Œ: {url[:50]}...")
        return url
    except Exception as e:
        print(f"URL ìˆ˜ì§‘ ì‹¤íŒ¨: {e}")
        return None
```

### **ğŸ” ìŠ¤ë§ˆíŠ¸ ìŠ¤í¬ë¡¤ ë²„íŠ¼ ì°¾ê¸°**

```python
def expand_product_details(self):
    """ìƒì„¸ì •ë³´ í¼ì³ë³´ê¸° (ê¸°ì¡´ ë¡œì§ ì¬ì‚¬ìš©)"""
    max_scrolls = 16
    scroll_amount = 800

    for scroll_count in range(max_scrolls):
        if not self.automation_running:  # ì¤‘ë‹¨ í™•ì¸
            return False

        try:
            location = pyautogui.locateOnScreen('detail_button.png', confidence=0.8)
            if location:
                center = pyautogui.center(location)
                pyautogui.click(center)
                print(f"ìƒì„¸ì •ë³´ í¼ì³ë³´ê¸° ì™„ë£Œ (ìŠ¤í¬ë¡¤ {scroll_count + 1}íšŒ)")
                time.sleep(2)  # í˜ì´ì§€ ë¡œë”© ëŒ€ê¸°
                return True
        except pyautogui.ImageNotFoundException:
            pass

        # ìŠ¤í¬ë¡¤ ë‹¤ìš´
        pyautogui.scroll(-scroll_amount)
        time.sleep(0.5)

    print("ìƒì„¸ì •ë³´ í¼ì³ë³´ê¸° ë²„íŠ¼ì„ ì°¾ì§€ ëª»í•¨")
    return False
```

### **ğŸ“¸ Fireshot ìº¡ì²˜**

```python
def capture_with_fireshot(self):
    """íŒŒì´ì–´ìƒ·ìœ¼ë¡œ ìƒì„¸í˜ì´ì§€ ìº¡ì²˜"""
    try:
        # Fireshot ì‹¤í–‰ (Ctrl+Shift+S)
        pyautogui.hotkey('ctrl', 'shift', 's')
        time.sleep(3)  # ìº¡ì²˜ ì™„ë£Œ ëŒ€ê¸°

        # ì €ì¥ ë²„íŠ¼ í´ë¦­
        save_button = pyautogui.locateOnScreen('fireshot_save.png', confidence=0.8)
        if save_button:
            pyautogui.click(save_button)
            time.sleep(2)
            return True

        return False
    except Exception as e:
        print(f"Fireshot ìº¡ì²˜ ì‹¤íŒ¨: {e}")
        return False
```

### **ğŸ•¸ï¸ í¬ë¡¤ë§ ì‹œí€€ìŠ¤ (4ë‹¨ê³„)**

```python
def crawling_sequence(self):
    """í¬ë¡¤ë§ ì‹œí€€ìŠ¤ ì‹¤í–‰"""
    try:
        # 1ë‹¨ê³„: í¬ë¡¤ë§íˆ´ ì‹¤í–‰ (Ctrl+Shift+A)
        pyautogui.hotkey('ctrl', 'shift', 'a')
        time.sleep(3)

        # 2ë‹¨ê³„: í¬ë¡¤ë§ íŒì—…ì—ì„œ ë¦¬ë·° ë²„íŠ¼ í´ë¦­
        if not self.wait_for_button_with_context('review_button.png', 'popup_context.png'):
            return False

        # 3ë‹¨ê³„: ë¦¬ë·° í™”ë©´ì—ì„œ ë¶„ì„ì‹œì‘í•˜ê¸° í´ë¦­
        if not self.wait_for_button_with_context('analysis_start.png', 'review_context.png'):
            return False

        # 4ë‹¨ê³„: ë¶„ì„ ê²°ê³¼ì—ì„œ ì—‘ì…€ ë‹¤ìš´ë¡œë“œ í´ë¦­
        if not self.wait_for_button_with_context('excel_download.png', 'result_context.png', timeout=60):
            return False

        print("í¬ë¡¤ë§ ì‹œí€€ìŠ¤ ì™„ë£Œ")
        return True

    except Exception as e:
        print(f"í¬ë¡¤ë§ ì‹œí€€ìŠ¤ ì‹¤íŒ¨: {e}")
        return False
```

### **ğŸ¯ ì»¨í…ìŠ¤íŠ¸ ê¸°ë°˜ ë²„íŠ¼ í´ë¦­**

```python
def wait_for_button_with_context(self, button_image, context_image, timeout=30):
    """ì»¨í…ìŠ¤íŠ¸ë¥¼ í™•ì¸í•œ í›„ ë²„íŠ¼ í´ë¦­"""
    start_time = time.time()

    while time.time() - start_time < timeout:
        if not self.automation_running:  # ì¤‘ë‹¨ í™•ì¸
            return False

        try:
            # ì»¨í…ìŠ¤íŠ¸ í™•ì¸ (context_imageê°€ Noneì´ë©´ ê±´ë„ˆë›°ê¸°)
            if context_image:
                context_location = pyautogui.locateOnScreen(context_image, confidence=0.7)
                if not context_location:
                    time.sleep(1)
                    continue

            # ë²„íŠ¼ ì°¾ê¸°
            button_location = pyautogui.locateOnScreen(button_image, confidence=0.8)
            if button_location:
                center = pyautogui.center(button_location)
                pyautogui.click(center)
                print(f"ë²„íŠ¼ í´ë¦­ ì„±ê³µ: {button_image}")
                time.sleep(2)  # í´ë¦­ í›„ ëŒ€ê¸°
                return True

        except pyautogui.ImageNotFoundException:
            pass

        time.sleep(1)

    print(f"ë²„íŠ¼ ì°¾ê¸° íƒ€ì„ì•„ì›ƒ: {button_image}")
    return False
```

### **ğŸ”„ ì¬ì‹œë„ ë¡œì§**

```python
def click_button_with_retry(self, image_path, button_name, max_retries=3):
    """ì¬ì‹œë„ ë¡œì§ì´ ìˆëŠ” ë²„íŠ¼ í´ë¦­"""
    for attempt in range(max_retries):
        if not self.automation_running:
            return False

        try:
            location = pyautogui.locateOnScreen(image_path, confidence=0.8)
            if location:
                center = pyautogui.center(location)
                pyautogui.click(center)
                print(f"{button_name} í´ë¦­ ì„±ê³µ (ì‹œë„ {attempt + 1})")
                time.sleep(2)
                return True
        except pyautogui.ImageNotFoundException:
            print(f"{button_name} ì°¾ê¸° ì‹¤íŒ¨ (ì‹œë„ {attempt + 1})")
            time.sleep(2)

    return False
```

---

## ğŸ“ **íŒŒì¼ ì •ë¦¬ ì‹œìŠ¤í…œ**

### **ğŸ” íŒŒì¼ëª… íŒŒì‹±**

```python
def parse_filename(self, filename):
    """íŒŒì¼ëª…ì„ ë¶„ì„í•˜ì—¬ ì œí’ˆëª…, ë¸Œëœë“œëª…, íƒ€ì… ì¶”ì¶œ"""
    # íŒŒì¼ëª… íŒ¨í„´: "ì œí’ˆëª…_ë¸Œëœë“œëª…_íƒ€ì…_ë‚ ì§œì‹œê°„.í™•ì¥ì"

    try:
        name_without_ext = filename.rsplit('.', 1)[0]
        parts = name_without_ext.split('_')

        if len(parts) >= 4:
            product_name = parts[0]
            brand_name = parts[1]
            file_type = parts[2]
            timestamp = '_'.join(parts[3:])

            return {
                'product_name': product_name,
                'brand_name': brand_name,
                'file_type': file_type,
                'timestamp': timestamp,
                'original_filename': filename
            }
    except Exception as e:
        print(f"íŒŒì¼ëª… íŒŒì‹± ì‹¤íŒ¨: {filename}, ì˜¤ë¥˜: {e}")

    return None
```

### **ğŸ”„ ìˆœì„œ ê¸°ë°˜ ë§¤ì¹­**

```python
def get_next_pending_store(self):
    """ëŒ€ê¸° ì¤‘ì¸ ìŠ¤í† ì–´ ì •ë³´ ë°˜í™˜ (FIFO)"""
    if self.pending_stores:
        return self.pending_stores.pop(0)  # ê°€ì¥ ì˜¤ë˜ëœ ê²ƒë¶€í„°
    return None

def clean_old_pending_stores(self, cutoff_minutes=5):
    """ì˜¤ë˜ëœ ëŒ€ê¸° ì •ë³´ ì •ë¦¬"""
    cutoff_time = datetime.now() - timedelta(minutes=cutoff_minutes)
    self.pending_stores = [
        (store, timestamp) for store, timestamp in self.pending_stores
        if timestamp > cutoff_time
    ]
```

### **ğŸ” ì¤‘ë³µ íŒŒì¼ ì²´í¬**

```python
def get_file_hash(self, file_path):
    """íŒŒì¼ì˜ SHA-256 í•´ì‹œ ê³„ì‚°"""
    hash_sha256 = hashlib.sha256()
    try:
        with open(file_path, "rb") as f:
            for chunk in iter(lambda: f.read(4096), b""):
                hash_sha256.update(chunk)
        return hash_sha256.hexdigest()
    except Exception as e:
        print(f"í•´ì‹œ ê³„ì‚° ì‹¤íŒ¨: {file_path}, ì˜¤ë¥˜: {e}")
        return None

def check_duplicate(self, file_path):
    """ì¤‘ë³µ íŒŒì¼ ì²´í¬"""
    file_hash = self.get_file_hash(file_path)
    if file_hash is None:
        return False

    if file_hash in self.file_hashes:
        print(f"ì¤‘ë³µ íŒŒì¼ ë°œê²¬: {file_path}")
        return True

    self.file_hashes[file_hash] = file_path
    return False
```

### **ğŸ“Š ì—‘ì…€ ë°ì´í„°ë² ì´ìŠ¤ ê´€ë¦¬**

```python
def create_excel_database(self):
    """ì´ì»¤ë¨¸ìŠ¤ ìˆ˜ì§‘ ë°ì´í„°ë² ì´ìŠ¤ ìƒì„±"""
    columns = [
        "ìˆ˜ì§‘ì¼ì", "ì œí’ˆëª…", "ë¸Œëœë“œëª…", "ìŠ¤í† ì–´ëª…", "URL",
        "ìƒì„¸í˜ì´ì§€_íŒŒì¼ê²½ë¡œ", "ë¦¬ë·°ë°ì´í„°_íŒŒì¼ê²½ë¡œ", "ì²˜ë¦¬ìƒíƒœ", "ë¹„ê³ "
    ]

    df = pd.DataFrame(columns=columns)
    df.to_excel(self.database_file, index=False, engine='openpyxl')
    print(f"ë°ì´í„°ë² ì´ìŠ¤ ìƒì„± ì™„ë£Œ: {self.database_file}")

def add_to_database(self, product_name, brand_name, email_address=""):
    """ë°ì´í„°ë² ì´ìŠ¤ì— ìƒˆ í•­ëª© ì¶”ê°€"""
    try:
        # ê¸°ì¡´ ë°ì´í„° ë¡œë“œ
        if self.database_file.exists():
            df = pd.read_excel(self.database_file, engine='openpyxl')
        else:
            self.create_excel_database()
            df = pd.read_excel(self.database_file, engine='openpyxl')

        # ìƒˆ í–‰ ì¶”ê°€
        new_row = {
            "ìˆ˜ì§‘ì¼ì": self.today,
            "ì œí’ˆëª…": product_name,
            "ë¸Œëœë“œëª…": brand_name,
            "ì²˜ë¦¬ìƒíƒœ": "ìˆ˜ì§‘ì™„ë£Œ",
            "ì´ë©”ì¼ì£¼ì†Œ": email_address
        }

        df = df.append(new_row, ignore_index=True)
        df.to_excel(self.database_file, index=False, engine='openpyxl')

    except Exception as e:
        print(f"ë°ì´í„°ë² ì´ìŠ¤ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨: {e}")
```

---

## ğŸ§  **AI ì²˜ë¦¬ ì‹œìŠ¤í…œ**

### **ğŸ”¬ TwoStageProcessor í´ë˜ìŠ¤**

```python
class TwoStageProcessor:
    """2ë‹¨ê³„ ë¶„ë¦¬ ì²˜ë¦¬ ì‹œìŠ¤í…œ"""

    def __init__(self, config):
        self.config = config
        self.client = GeminiClient(config)

        # ë°œì†¡ ê´€ë¦¬ì ì´ˆê¸°í™”
        try:
            self.email_manager = EmailSenderManager()
        except Exception as e:
            logger.warning(f"ì´ë©”ì¼ ë°œì†¡ ê´€ë¦¬ì ì´ˆê¸°í™” ì‹¤íŒ¨: {e}")
            self.email_manager = None

    async def process_stage1_ocr(self, image_files: List[Path]) -> Dict[str, Any]:
        """Stage 1: OCR ë° ë°ì´í„° ì¶”ì¶œ"""
        logger.info(f"Stage 1 ì‹œì‘ - {len(image_files)}ê°œ ì´ë¯¸ì§€ ì²˜ë¦¬")

        ocr_results = {}

        for image_file in image_files:
            try:
                # Tesseract OCR ì‹¤í–‰
                ocr_text = self.extract_text_from_image(image_file)

                # OCR í›„ì²˜ë¦¬
                cleaned_text = self.clean_ocr_text(ocr_text)

                # êµ¬ì¡°í™”
                structured_data = await self.structure_product_data(cleaned_text)

                ocr_results[str(image_file)] = {
                    'raw_text': ocr_text,
                    'cleaned_text': cleaned_text,
                    'structured_data': structured_data
                }

            except Exception as e:
                logger.error(f"OCR ì²˜ë¦¬ ì‹¤íŒ¨ - {image_file}: {e}")
                continue

        return ocr_results

    async def process_stage2_email(self, stage1_results: Dict, review_files: List[Path]) -> List[Dict]:
        """Stage 2: ì½œë“œë©”ì¼ ìƒì„±"""
        logger.info("Stage 2 ì‹œì‘ - ì½œë“œë©”ì¼ ìƒì„±")

        generated_emails = []

        for image_path, ocr_data in stage1_results.items():
            for review_file in review_files:
                try:
                    # ë¦¬ë·° ë°ì´í„° ë¶„ì„
                    review_analysis = self.analyze_review_data(review_file)

                    # ì½œë“œë©”ì¼ ìƒì„±
                    email_content = await self.generate_cold_email(
                        ocr_data['structured_data'],
                        review_analysis
                    )

                    # ë°œì†¡ ê´€ë¦¬ìì— ë“±ë¡
                    if self.email_manager:
                        self.email_manager.add_to_pending_list(email_content)

                    generated_emails.append(email_content)

                except Exception as e:
                    logger.error(f"ì½œë“œë©”ì¼ ìƒì„± ì‹¤íŒ¨: {e}")
                    continue

        return generated_emails
```

### **ğŸ” OCR ì—”ì§„ (Tesseract)**

```python
def extract_text_from_image(self, image_path: Path) -> str:
    """Tesseractë¥¼ ì‚¬ìš©í•œ OCR í…ìŠ¤íŠ¸ ì¶”ì¶œ"""
    try:
        import pytesseract
        from PIL import Image

        # ì´ë¯¸ì§€ ë¡œë“œ ë° ì „ì²˜ë¦¬
        image = Image.open(image_path)

        # OCR ì„¤ì •
        custom_config = r'--oem 3 --psm 6 -l kor+eng'

        # OCR ì‹¤í–‰
        text = pytesseract.image_to_string(image, config=custom_config)

        return text

    except ImportError:
        logger.warning("Tesseractê°€ ì„¤ì¹˜ë˜ì§€ ì•ŠìŒ - ë”ë¯¸ í…ìŠ¤íŠ¸ ë°˜í™˜")
        return f"ë”ë¯¸ OCR í…ìŠ¤íŠ¸: {image_path.name}"
    except Exception as e:
        logger.error(f"OCR ì‹¤í–‰ ì‹¤íŒ¨: {e}")
        return ""

def clean_ocr_text(self, raw_text: str) -> str:
    """OCR í…ìŠ¤íŠ¸ í›„ì²˜ë¦¬"""
    # ë¶ˆí•„ìš”í•œ ë¬¸ì ì œê±°
    cleaned = re.sub(r'[^\w\sê°€-í£]', ' ', raw_text)

    # ì¤‘ë³µ ê³µë°± ì œê±°
    cleaned = re.sub(r'\s+', ' ', cleaned)

    # ê°€ê²© ì •ë³´ ì •ê·œí™”
    cleaned = re.sub(r'(\d+)ì›', r'\1 ì›', cleaned)

    return cleaned.strip()
```

### **ğŸ¯ Gemini í´ë¼ì´ì–¸íŠ¸**

```python
class GeminiClient:
    def __init__(self, config):
        self.config = config
        self.model = genai.GenerativeModel(config.llm.model_name)

        # ì•ˆì „ì¥ì¹˜ ì´ˆê¸°í™”
        self.budget_guard = BudgetGuard(config.budget.max_cost_per_job_usd)
        self.rate_limiter = RateLimiter(
            config.runtime.rate_limit['rpm_soft'],
            config.runtime.rate_limit['tpm_soft']
        )

    async def generate(self, prompt_template: Dict, user_input: str) -> Dict:
        """AI ì½œë“œë©”ì¼ ìƒì„±"""
        try:
            # ë¹„ìš© ì²´í¬
            if not self.budget_guard.can_proceed():
                raise Exception("ì˜ˆì‚° í•œë„ ì´ˆê³¼")

            # ë ˆì´íŠ¸ ë¦¬ë¯¸íŒ…
            await self.rate_limiter.wait_if_needed()

            # í”„ë¡¬í”„íŠ¸ ì¡°ë¦½
            full_prompt = self.build_prompt(prompt_template, user_input)

            # AI í˜¸ì¶œ
            response = await self.model.generate_content_async(full_prompt)

            # ë¹„ìš© ì—…ë°ì´íŠ¸
            self.budget_guard.add_cost(self.estimate_cost(response))

            # JSON íŒŒì‹±
            result = json.loads(response.text)

            return result

        except Exception as e:
            logger.error(f"AI ìƒì„± ì‹¤íŒ¨: {e}")
            raise
```

### **ğŸ’° ë¹„ìš© ê´€ë¦¬**

```python
class BudgetGuard:
    def __init__(self, max_cost_usd: float):
        self.max_cost = max_cost_usd
        self.current_cost = 0.0

    def can_proceed(self) -> bool:
        return self.current_cost < self.max_cost

    def add_cost(self, cost: float):
        self.current_cost += cost
        if self.current_cost >= self.max_cost * 0.9:  # 90% ë„ë‹¬ ì‹œ ê²½ê³ 
            logger.warning(f"ì˜ˆì‚° 90% ì‚¬ìš©: ${self.current_cost:.2f} / ${self.max_cost:.2f}")

class RateLimiter:
    def __init__(self, rpm_limit: int, tpm_limit: int):
        self.rpm_limit = rpm_limit
        self.tpm_limit = tpm_limit
        self.request_times = []
        self.token_usage = []

    async def wait_if_needed(self):
        current_time = time.time()

        # 1ë¶„ ì´ë‚´ ìš”ì²­ ìˆ˜ ì²´í¬
        recent_requests = [t for t in self.request_times if current_time - t < 60]

        if len(recent_requests) >= self.rpm_limit:
            wait_time = 60 - (current_time - recent_requests[0])
            await asyncio.sleep(wait_time)

        self.request_times.append(current_time)
```

---

## ğŸ“§ **ì½œë“œë©”ì¼ ë°œì†¡ ê´€ë¦¬ ì‹œìŠ¤í…œ**

### **ğŸ“‹ EmailSenderManager í´ë˜ìŠ¤**

```python
class EmailSenderManager:
    """ì½œë“œë©”ì¼ ë°œì†¡ ê´€ë¦¬ ì‹œìŠ¤í…œ"""

    def __init__(self):
        # ê²½ë¡œ ì„¤ì •
        self.work_folder = Path("E:/ì—…ë¬´")
        self.database_file = Path("E:/ì—…ë¬´/03_ë°ì´í„°_ìˆ˜ì§‘/ì´ì»¤ë¨¸ìŠ¤_ìˆ˜ì§‘_ë°ì´í„°ë² ì´ìŠ¤.xlsx")
        self.coldmail_folder = Path("E:/ì—…ë¬´/4.ì½œë“œë©”ì¼_ê´€ë¦¬")
        self.pending_folder = self.coldmail_folder / "ë°œì†¡ëŒ€ê¸°"
        self.sent_folder = self.coldmail_folder / "ë°œì†¡ì™„ë£Œ"
        self.pending_excel = self.pending_folder / "ì½œë“œë©”ì¼_ë°œì†¡ëŒ€ê¸°_ë¦¬ìŠ¤íŠ¸.xlsx"

        # í´ë” ìƒì„±
        self.pending_folder.mkdir(parents=True, exist_ok=True)
        self.sent_folder.mkdir(parents=True, exist_ok=True)

        # ë°œì†¡ëŒ€ê¸° ì—‘ì…€ ì´ˆê¸°í™”
        self.init_pending_excel()

    def init_pending_excel(self):
        """ë°œì†¡ëŒ€ê¸° ì—‘ì…€ íŒŒì¼ ì´ˆê¸°í™”"""
        if not self.pending_excel.exists():
            columns = [
                "ìƒì„±ì¼ì‹œ", "ì œí’ˆëª…", "ë¸Œëœë“œëª…", "ìŠ¤í† ì–´ëª…", "ì½œë“œë©”ì¼_íŒŒì¼ê²½ë¡œ",
                "ë°œì†¡ìƒíƒœ", "ë°œì†¡ì˜ˆì •ì¼", "ë‹´ë‹¹ì", "ë¹„ê³ "
            ]
            df = pd.DataFrame(columns=columns)
            df.to_excel(self.pending_excel, index=False, engine='openpyxl')

    def add_to_pending_list(self, email_data: Dict):
        """ë°œì†¡ëŒ€ê¸° ë¦¬ìŠ¤íŠ¸ì— ì¶”ê°€"""
        try:
            # ì½œë“œë©”ì¼ íŒŒì¼ ì €ì¥
            timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
            email_filename = f"ì½œë“œë©”ì¼_{email_data.get('ì œí’ˆëª…', 'unknown')}_{timestamp}.json"
            email_filepath = self.pending_folder / email_filename

            with open(email_filepath, 'w', encoding='utf-8') as f:
                json.dump(email_data, f, ensure_ascii=False, indent=2)

            # ë°œì†¡ëŒ€ê¸° ì—‘ì…€ ì—…ë°ì´íŠ¸
            df = pd.read_excel(self.pending_excel, engine='openpyxl')

            new_row = {
                "ìƒì„±ì¼ì‹œ": datetime.now().strftime("%Y-%m-%d %H:%M:%S"),
                "ì œí’ˆëª…": email_data.get('ì œí’ˆëª…', ''),
                "ë¸Œëœë“œëª…": email_data.get('ë¸Œëœë“œëª…', ''),
                "ìŠ¤í† ì–´ëª…": email_data.get('ìŠ¤í† ì–´ëª…', ''),
                "ì½œë“œë©”ì¼_íŒŒì¼ê²½ë¡œ": str(email_filepath),
                "ë°œì†¡ìƒíƒœ": "ëŒ€ê¸°",
                "ë°œì†¡ì˜ˆì •ì¼": (datetime.now() + timedelta(days=1)).strftime("%Y-%m-%d"),
                "ë‹´ë‹¹ì": "",
                "ë¹„ê³ ": "ìë™ìƒì„±"
            }

            df = df.append(new_row, ignore_index=True)
            df.to_excel(self.pending_excel, index=False, engine='openpyxl')

            logger.info(f"ë°œì†¡ëŒ€ê¸° ë¦¬ìŠ¤íŠ¸ì— ì¶”ê°€ë¨: {email_filename}")

        except Exception as e:
            logger.error(f"ë°œì†¡ëŒ€ê¸° ë¦¬ìŠ¤íŠ¸ ì¶”ê°€ ì‹¤íŒ¨: {e}")
```

---

## ğŸ® **GUI ì‹œìŠ¤í…œë“¤**

### **ğŸ¯ í†µí•© ìë™í™” GUI (ultimate_automation_system.py)**

```python
class UltimateAutomationSystem:
    """ê¶ê·¹ì˜ í†µí•© ìë™í™” ì‹œìŠ¤í…œ"""

    def __init__(self):
        self.root = tk.Tk()
        self.root.title("ê¶ê·¹ì˜ ì´ì»¤ë¨¸ìŠ¤ ì½œë“œë©”ì¼ ìë™í™” ì‹œìŠ¤í…œ - ì™„ì „í†µí•©")
        self.root.geometry("1800x1200")

        # ìƒíƒœ ë³€ìˆ˜ë“¤
        self.automation_running = False
        self.is_ai_processing = False
        self.generated_emails = []

        # ì„¤ì • ê°’ë“¤
        self.total_products = 30
        self.tone_var = tk.StringVar(value="consultant")
        self.min_chars = tk.IntVar(value=350)
        self.max_chars = tk.IntVar(value=600)

        self.create_widgets()
        self.setup_hotkeys()

    def create_widgets(self):
        """í†µí•© GUI ìœ„ì ¯ ìƒì„±"""
        # ë©”ì¸ ì œëª©
        title_frame = tk.Frame(self.root, bg="#1a252f", height=80)
        title_frame.pack(fill="x", padx=5, pady=5)

        # ë©”ì¸ ì»¨íŠ¸ë¡¤ íŒ¨ë„
        self.create_main_control_panel()

        # íƒ­ ì‹œìŠ¤í…œ
        self.notebook = ttk.Notebook(self.root)
        self.notebook.pack(fill="both", expand=True, padx=10, pady=5)

        # ê° íƒ­ ìƒì„±
        self.create_automation_tab()      # ìë™í™” í˜„í™©
        self.create_web_automation_tab()  # ì›¹ ìë™í™”
        self.create_ai_generation_tab()   # AI ì½œë“œë©”ì¼
        self.create_client_discovery_tab() # ê³ ê°ì‚¬ ë°œêµ´
        self.create_results_tab()         # ê²°ê³¼ ë³´ê¸°
        self.create_settings_tab()        # ì„¤ì •

    def start_complete_automation(self):
        """ì™„ì „ ìë™í™” ì‹œì‘ - ë©”ì¸ ê¸°ëŠ¥"""
        if self.automation_running:
            messagebox.showwarning("ê²½ê³ ", "ì´ë¯¸ ìë™í™”ê°€ ì‹¤í–‰ ì¤‘ì…ë‹ˆë‹¤.")
            return

        # ì‚¬ì „ ì²´í¬
        if not self.pre_automation_check():
            return

        # í™•ì¸ ëŒ€í™”ìƒì
        total_products = self.total_products_var.get()
        response = messagebox.askyesno(
            "ì™„ì „ ìë™í™” ì‹œì‘",
            f"ì™„ì „ ìë™í™”ë¥¼ ì‹œì‘í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\n"
            f"ğŸ¯ ì²˜ë¦¬í•  ì œí’ˆ: {total_products}ê°œ\n"
            f"â° ì˜ˆìƒ ì†Œìš”ì‹œê°„: 2-3ì‹œê°„\n"
            f"ğŸ“§ ì˜ˆìƒ ìƒì„±ë¬¼: {total_products}ê°œ ì½œë“œë©”ì¼\n"
        )

        if response:
            self.automation_running = True
            threading.Thread(target=self.complete_automation_thread, daemon=True).start()
```

### **ğŸ”„ 2ë‹¨ê³„ GUI (two_stage_gui.py)**

```python
class TwoStageGUI:
    def __init__(self, root):
        self.root = root
        self.root.title("ğŸ¯ AI ì½œë“œë©”ì¼ 2ë‹¨ê³„ ë¶„ë¦¬ ì²˜ë¦¬ ì‹œìŠ¤í…œ")
        self.root.geometry("1000x700")

        # 2ë‹¨ê³„ ì²˜ë¦¬ê¸° ì´ˆê¸°í™”
        config = load_config()
        self.processor = TwoStageProcessor(config)

        # GUI ìš”ì†Œë“¤
        self.create_stage1_tab()
        self.create_stage2_tab()
        self.create_settings_tab()

    def create_stage1_tab(self):
        """Stage 1: OCR ë° ë°ì´í„° ì¶”ì¶œ íƒ­"""
        stage1_frame = ttk.Frame(self.notebook)
        self.notebook.add(stage1_frame, text="Stage 1: OCR")

        # ì´ë¯¸ì§€ íŒŒì¼ ì„ íƒ
        file_select_frame = tk.LabelFrame(stage1_frame, text="ì´ë¯¸ì§€ íŒŒì¼ ì„ íƒ")
        file_select_frame.pack(fill="x", padx=10, pady=5)

        tk.Button(file_select_frame, text="ì´ë¯¸ì§€ í´ë” ì„ íƒ",
                 command=self.select_image_folder).pack(side="left", padx=5)

        # OCR ì‹¤í–‰ ë²„íŠ¼
        ocr_frame = tk.LabelFrame(stage1_frame, text="OCR ì‹¤í–‰")
        ocr_frame.pack(fill="x", padx=10, pady=5)

        tk.Button(ocr_frame, text="Stage 1 ì‹¤í–‰ (OCR + êµ¬ì¡°í™”)",
                 command=self.run_stage1).pack(pady=10)

    def run_stage1(self):
        """Stage 1 ì‹¤í–‰"""
        def stage1_thread():
            try:
                self.update_status("Stage 1 ì‹¤í–‰ ì¤‘...")

                # ì´ë¯¸ì§€ íŒŒì¼ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
                image_files = self.get_selected_images()

                # ë¹„ë™ê¸° OCR ì²˜ë¦¬
                loop = asyncio.new_event_loop()
                asyncio.set_event_loop(loop)

                results = loop.run_until_complete(
                    self.processor.process_stage1_ocr(image_files)
                )

                loop.close()

                # ê²°ê³¼ ì €ì¥
                self.stage1_results = results
                self.update_status(f"Stage 1 ì™„ë£Œ: {len(results)}ê°œ ì´ë¯¸ì§€ ì²˜ë¦¬ë¨")

            except Exception as e:
                messagebox.showerror("ì˜¤ë¥˜", f"Stage 1 ì‹¤í–‰ ì‹¤íŒ¨: {e}")

        threading.Thread(target=stage1_thread, daemon=True).start()
```

---

## ğŸ” **ê³ ê°ì‚¬ ë°œêµ´ ì‹œìŠ¤í…œ**

### **ğŸ•¸ï¸ NaverShoppingCrawler í´ë˜ìŠ¤**

```python
class NaverShoppingCrawler:
    def __init__(self, config_path: str):
        with open(config_path, 'r', encoding='utf-8') as f:
            self.config = json.load(f)

        self.driver = None
        self.results = []

    def start_crawling(self) -> List[Dict]:
        """í¬ë¡¤ë§ ì‹œì‘"""
        try:
            self.setup_driver()

            # í˜„ì¬ í˜ì´ì§€ì—ì„œ ìŠ¤í† ì–´ ì¹´ë“œë“¤ ìŠ¤ìº”
            store_cards = self.scan_current_page()

            # í•„í„°ë§ ì ìš©
            filtered_stores = self.apply_filters(store_cards)

            # ê²°ê³¼ ì €ì¥
            self.save_results(filtered_stores)

            return filtered_stores

        except Exception as e:
            logger.error(f"í¬ë¡¤ë§ ì‹¤íŒ¨: {e}")
            return []
        finally:
            if self.driver:
                self.driver.quit()

    def scan_current_page(self) -> List[Dict]:
        """í˜„ì¬ í˜ì´ì§€ì˜ ìŠ¤í† ì–´ ì¹´ë“œë“¤ ìŠ¤ìº”"""
        store_cards = []

        try:
            # í˜ì´ì§€ì˜ ëª¨ë“  ìƒí’ˆ ì¹´ë“œ ì°¾ê¸°
            product_elements = self.driver.find_elements(
                By.CSS_SELECTOR, ".product_item, .item_area"
            )

            for element in product_elements:
                try:
                    store_info = self.extract_store_info(element)
                    if store_info:
                        store_cards.append(store_info)
                except Exception as e:
                    logger.warning(f"ì¹´ë“œ ì •ë³´ ì¶”ì¶œ ì‹¤íŒ¨: {e}")
                    continue

        except Exception as e:
            logger.error(f"í˜ì´ì§€ ìŠ¤ìº” ì‹¤íŒ¨: {e}")

        return store_cards

    def extract_store_info(self, element) -> Dict:
        """ê°œë³„ ìŠ¤í† ì–´ ì •ë³´ ì¶”ì¶œ"""
        try:
            # OCRì„ ì‚¬ìš©í•œ í…ìŠ¤íŠ¸ ì¶”ì¶œ
            screenshot = element.screenshot_as_png

            # pytesseractë¡œ í…ìŠ¤íŠ¸ ì¶”ì¶œ
            text = pytesseract.image_to_string(
                Image.open(io.BytesIO(screenshot)),
                lang='kor+eng'
            )

            # ì •ê·œì‹ìœ¼ë¡œ ì •ë³´ ì¶”ì¶œ
            review_count = self.extract_review_count(text)
            follower_count = self.extract_follower_count(text)

            return {
                'store_name': self.extract_store_name(text),
                'product_name': self.extract_product_name(text),
                'review_count': review_count,
                'follower_count': follower_count,
                'price': self.extract_price(text),
                'rating': self.extract_rating(text),
                'link': element.find_element(By.TAG_NAME, "a").get_attribute("href")
            }

        except Exception as e:
            logger.error(f"ìŠ¤í† ì–´ ì •ë³´ ì¶”ì¶œ ì‹¤íŒ¨: {e}")
            return None
```

---

## ğŸš€ **ì‹¤í–‰ ë° ë¹Œë“œ ì‹œìŠ¤í…œ**

### **ğŸ“¦ PyInstaller ë¹Œë“œ ìŠ¤í¬ë¦½íŠ¸**

```python
# complete_automation.spec
# -*- mode: python ; coding: utf-8 -*-

block_cipher = None

a = Analysis(
    ['ultimate_automation_system.py'],
    pathex=['E:\\VSC\\all_in_one\\all_in_one_new\\all_in_one'],
    binaries=[],
    datas=[
        ('config', 'config'),
        ('llm/prompts', 'llm/prompts'),
        ('gui', 'gui'),
        ('compose', 'compose'),
        ('client_discovery', 'client_discovery'),
        ('data', 'data'),
    ],
    hiddenimports=[
        'google.generativeai',
        'pytesseract',
        'openpyxl',
        'pandas',
        'pyautogui',
        'pyperclip',
        'loguru',
        'PIL',
    ],
    hookspath=[],
    hooksconfig={},
    runtime_hooks=[],
    excludes=[],
    win_no_prefer_redirects=False,
    win_private_assemblies=False,
    cipher=block_cipher,
    noarchive=False,
)

pyd = PYZ(a.pure, a.zipped_data, cipher=block_cipher)

exe = EXE(
    pyd,
    a.scripts,
    [],
    exclude_binaries=True,
    name='CompleteAutomation',
    debug=False,
    bootloader_ignore_signals=False,
    strip=False,
    upx=True,
    console=False,  # GUI ëª¨ë“œ
    disable_windowed_traceback=False,
    target_arch=None,
    codesign_identity=None,
    entitlements_file=None,
    icon='assets/icon.ico'  # ì•„ì´ì½˜ ì„¤ì •
)

coll = COLLECT(
    exe,
    a.binaries,
    a.zipfiles,
    a.datas,
    strip=False,
    upx=True,
    upx_exclude=[],
    name='CompleteAutomation'
)
```

### **ğŸ› ï¸ í™˜ê²½ ì„¤ì • ìŠ¤í¬ë¦½íŠ¸**

```bash
# setup_env_vars.bat
@echo off
echo ====== í™˜ê²½ ë³€ìˆ˜ ì„¤ì • ======

:: Google AI Studio í”„ë¡œì íŠ¸ ID ì„¤ì •
set VERTEX_PROJECT_ID=jadong-471919
echo VERTEX_PROJECT_ID ì„¤ì • ì™„ë£Œ: %VERTEX_PROJECT_ID%

:: í™˜ê²½ ë³€ìˆ˜ ì˜êµ¬ ì €ì¥
setx VERTEX_PROJECT_ID "%VERTEX_PROJECT_ID%"

:: Tesseract ê²½ë¡œ í™•ì¸
if exist "E:\tesseract\tesseract.exe" (
    echo Tesseract ì„¤ì¹˜ í™•ì¸ë¨
    set TESSDATA_PREFIX=E:\tesseract\tessdata
    setx TESSDATA_PREFIX "%TESSDATA_PREFIX%"
) else (
    echo [WARNING] Tesseractê°€ ì„¤ì¹˜ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤
    echo ë‹¤ìš´ë¡œë“œ: https://github.com/UB-Mannheim/tesseract/wiki
)

:: Python íŒ¨í‚¤ì§€ ì„¤ì¹˜
echo Python íŒ¨í‚¤ì§€ ì„¤ì¹˜ ì¤‘...
pip install -r requirements.txt

echo ====== ì„¤ì • ì™„ë£Œ ======
pause
```

### **ğŸ“‹ ìš”êµ¬ì‚¬í•­ íŒŒì¼**

```text
# requirements.txt
google-generativeai>=0.3.0
pytesseract>=0.3.10
Pillow>=9.0.0
pandas>=1.5.0
openpyxl>=3.1.0
pyautogui>=0.9.54
pyperclip>=1.8.2
loguru>=0.7.0
selenium>=4.15.0
beautifulsoup4>=4.12.0
requests>=2.31.0
tkinter  # í‘œì¤€ ë¼ì´ë¸ŒëŸ¬ë¦¬ì´ì§€ë§Œ ëª…ì‹œ
pathlib  # í‘œì¤€ ë¼ì´ë¸ŒëŸ¬ë¦¬
json     # í‘œì¤€ ë¼ì´ë¸ŒëŸ¬ë¦¬
threading # í‘œì¤€ ë¼ì´ë¸ŒëŸ¬ë¦¬
asyncio  # í‘œì¤€ ë¼ì´ë¸ŒëŸ¬ë¦¬
```

---

## ğŸ”§ **ì„¤ì • íŒŒì¼ë“¤**

### **âš™ï¸ config.yaml**

```yaml
# config/config.yaml
llm:
  model_name: "gemini-1.5-pro"
  temperature: 0.3
  max_tokens: 2048

paths:
  input_images_dir: "data/product_images"
  input_reviews_dir: "data/reviews"
  output_root_dir: "outputs"
  prompts_dir: "llm/prompts"

budget:
  max_cost_per_job_usd: 10.0

runtime:
  rate_limit:
    rpm_soft: 30
    tpm_soft: 50000

policy:
  email_min_chars: 350
  email_max_chars: 600
  tone_default: "consultant"

file_organizer:
  download_folder: "C:/Users/Administrator/Downloads"
  work_folder: "E:/ì—…ë¬´"
  database_file: "E:/ì—…ë¬´/03_ë°ì´í„°_ìˆ˜ì§‘/ì´ì»¤ë¨¸ìŠ¤_ìˆ˜ì§‘_ë°ì´í„°ë² ì´ìŠ¤.xlsx"
  max_scrolls: 16
  scroll_amount: 800
  button_confidence: 0.8
  context_confidence: 0.7
```

### **ğŸ¯ ê³ ê°ì‚¬ ë°œêµ´ ì„¤ì •**

```json
// client_discovery/config.json
{
  "selenium": {
    "driver_path": "chromedriver.exe",
    "headless": false,
    "window_size": [1920, 1080],
    "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"
  },
  "crawling": {
    "max_products_per_page": 40,
    "scroll_delay": 2,
    "element_wait_timeout": 10
  },
  "filters": {
    "review_count_min": 200,
    "review_count_max": 300,
    "follower_count_min": 50,
    "follower_count_max": 1500
  },
  "ocr": {
    "lang": "kor+eng",
    "config": "--oem 3 --psm 6"
  },
  "output": {
    "format": "csv",
    "encoding": "utf-8-sig"
  }
}
```

---

## ğŸ›¡ï¸ **ì—ëŸ¬ ì²˜ë¦¬ ë° ë¡œê¹…**

### **ğŸ“Š ë¡œê¹… ì‹œìŠ¤í…œ**

```python
# core/logger.py
from loguru import logger
import sys
from pathlib import Path

def setup_logger(job_id: str, output_dir: str):
    """ì‘ì—…ë³„ ë¡œê±° ì„¤ì •"""

    # ê¸°ì¡´ í•¸ë“¤ëŸ¬ ì œê±°
    logger.remove()

    # ì½˜ì†” ì¶œë ¥
    logger.add(
        sys.stdout,
        format="<green>{time:YYYY-MM-DD HH:mm:ss}</green> | <level>{level: <8}</level> | <cyan>{name}</cyan>:<cyan>{function}</cyan>:<cyan>{line}</cyan> - <level>{message}</level>",
        level="INFO"
    )

    # íŒŒì¼ ì¶œë ¥
    log_file = Path(output_dir) / f"{job_id}_automation.log"
    logger.add(
        log_file,
        format="{time:YYYY-MM-DD HH:mm:ss} | {level: <8} | {name}:{function}:{line} - {message}",
        level="DEBUG",
        rotation="10 MB",
        retention="30 days",
        encoding="utf-8"
    )

    return logger
```

### **ğŸ”’ ì•ˆì „ì¥ì¹˜ ì‹œìŠ¤í…œ**

```python
# core/safety_monitor.py
class SafetyMonitor:
    def __init__(self):
        self.start_time = time.time()
        self.max_runtime_hours = 6  # ìµœëŒ€ 6ì‹œê°„ ì‹¤í–‰
        self.memory_threshold_mb = 2048  # 2GB ë©”ëª¨ë¦¬ ì œí•œ

    def check_runtime_limit(self):
        """ì‹¤í–‰ ì‹œê°„ ì œí•œ ì²´í¬"""
        elapsed_hours = (time.time() - self.start_time) / 3600
        if elapsed_hours > self.max_runtime_hours:
            raise RuntimeError(f"ìµœëŒ€ ì‹¤í–‰ ì‹œê°„ ì´ˆê³¼: {elapsed_hours:.1f}ì‹œê°„")

    def check_memory_usage(self):
        """ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ì²´í¬"""
        import psutil
        process = psutil.Process()
        memory_mb = process.memory_info().rss / 1024 / 1024

        if memory_mb > self.memory_threshold_mb:
            logger.warning(f"ë†’ì€ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰: {memory_mb:.1f}MB")

        return memory_mb

    def emergency_stop_check(self):
        """ê¸´ê¸‰ ì¤‘ë‹¨ ì²´í¬"""
        # ESC í‚¤ ì²´í¬, íŒŒì¼ ê¸°ë°˜ ì¤‘ë‹¨ ì‹ í˜¸ ë“±
        stop_file = Path("EMERGENCY_STOP")
        if stop_file.exists():
            stop_file.unlink()  # íŒŒì¼ ì‚­ì œ
            raise KeyboardInterrupt("ê¸´ê¸‰ ì¤‘ë‹¨ ì‹ í˜¸ ê°ì§€")
```

---

## ğŸ¯ **ì™„ë£Œ! ì™„ì „í•œ ê¸°ìˆ  ëª…ì„¸ì„œ ë°±ì—… ì™„ë£Œ**

ì´ì œ ëª¨ë“  ê¸°ìˆ ì  ì„¸ë¶€ì‚¬í•­ì´ ì™„ì „íˆ ë°±ì—…ë˜ì—ˆìŠµë‹ˆë‹¤. ì´ ë¬¸ì„œë“¤ì„ ê¸°ë°˜ìœ¼ë¡œ 100% ì •í™•í•œ ë³µì›ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤!