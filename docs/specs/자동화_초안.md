# 🎯 완전 통합 자동화 시스템 - 상세 동작 명세서 (자연어)

## 📌 **시스템 전체 개요**
30개의 네이버 스마트스토어 제품을 완전 자동으로 처리하여 30개의 맞춤형 콜드메일을 생성하는 시스템

---

## 🌐 **Phase 1: 웹 자동화 (30개 제품 처리)**

### **사전 준비 작업**
1. Chrome 브라우저를 실행합니다
2. 30개의 제품 상세페이지를 각각 새 탭에 열어둡니다
3. 첫 번째 탭을 활성화합니다
4. 프로그램 실행 전 다음 확장프로그램이 설치되어 있는지 확인:
   - FireShot (전체 페이지 캡처용)
   - 이커머스AI솔루션 (리뷰 크롤링용)

### **제품별 처리 과정 (1개 제품당 약 2-3분)**

#### **Step 1: URL 수집**
1. 키보드에서 `Ctrl` 키와 `L` 키를 동시에 누릅니다 (주소창 선택)
2. 0.5초 대기합니다
3. 키보드에서 `Ctrl` 키와 `C` 키를 동시에 누릅니다 (URL 복사)
4. 0.5초 대기합니다
5. 클립보드에서 URL 텍스트를 읽어옵니다
6. 수집한 URL을 메모리의 `collected_urls` 리스트에 저장합니다

#### **Step 2: 상세정보 펼쳐보기**
1. 현재 화면을 캡처합니다
2. `detail_button.png` 이미지(상세정보 펼쳐보기 버튼)를 화면에서 검색합니다
3. 버튼을 찾지 못한 경우:
   - 마우스 휠을 아래로 800픽셀 스크롤합니다
   - 0.5초 대기합니다
   - 다시 버튼을 검색합니다
   - 최대 16번까지 반복합니다
4. 버튼을 찾은 경우:
   - 버튼의 중앙 좌표를 계산합니다
   - 해당 좌표로 마우스를 이동합니다
   - 마우스 왼쪽 버튼을 클릭합니다
   - 2초 대기합니다 (페이지 로딩 시간)

#### **Step 3: FireShot 페이지 캡처**
1. 키보드에서 `Ctrl`, `Shift`, `S` 키를 동시에 누릅니다 (FireShot 실행)
2. 3초 대기합니다 (FireShot 로딩 시간)
3. FireShot 캡처 모드가 활성화되면 자동으로 전체 페이지 캡처가 시작됩니다
4. 캡처 진행 중 최대 120초까지 대기합니다
5. `fireshot_save.png` 이미지(저장 버튼)를 1초마다 화면에서 검색합니다
6. 저장 버튼을 찾으면:
   - 버튼의 중앙 좌표로 마우스를 이동합니다
   - 마우스 왼쪽 버튼을 클릭합니다
   - 파일이 다운로드 폴더에 저장됩니다
7. 2초 대기합니다 (저장 완료 시간)

#### **Step 4: 리뷰 크롤링 시퀀스**

**4-1. 크롤링툴 실행**
1. 키보드에서 `Ctrl`, `Shift`, `A` 키를 동시에 누릅니다 (크롤링툴 실행)
2. 3초 대기합니다 (크롤링툴 로딩)
3. `popup_context.png` 이미지를 검색하여 크롤링 팝업이 열렸는지 확인합니다

**4-2. 리뷰 버튼 클릭**
1. 크롤링 팝업이 확인되면 `review_button.png` 이미지를 검색합니다
2. 최대 30초 동안 1초마다 재검색합니다
3. 버튼을 찾으면:
   - 버튼 중앙을 클릭합니다
   - 2초 대기합니다

**4-3. 분석 시작**
1. `review_context.png` 이미지를 검색하여 리뷰 화면인지 확인합니다
2. 리뷰 화면이 확인되면 `analysis_start.png` 버튼을 검색합니다
3. 최대 30초 동안 1초마다 재검색합니다
4. 버튼을 찾으면:
   - 버튼 중앙을 클릭합니다
   - 5초 대기합니다 (분석 시작)

**4-4. 엑셀 다운로드**
1. `result_context.png` 이미지를 검색하여 결과 화면인지 확인합니다
2. 결과 화면이 확인되면 `excel_download.png` 버튼을 검색합니다
3. 최대 60초 동안 1초마다 재검색합니다 (분석 시간)
4. 버튼을 찾으면:
   - 버튼 중앙을 클릭합니다
   - 파일이 다운로드 폴더에 저장됩니다
   - 3초 대기합니다

**4-5. 크롤링툴 닫기**
1. 화면 좌표 (1898, 134) 위치로 마우스를 이동합니다
2. 마우스 왼쪽 버튼을 클릭합니다 (빈 공간 클릭으로 팝업 닫기)
3. 1초 대기합니다

#### **Step 5: 다음 제품으로 이동**
1. 키보드에서 `Ctrl` 키와 `W` 키를 동시에 누릅니다 (현재 탭 닫기)
2. 1초 대기합니다
3. 다음 탭이 자동으로 활성화됩니다
4. Step 1부터 반복합니다

### **예외 처리**
- ESC 키를 누르면 언제든지 자동화가 중단됩니다
- 각 버튼 클릭은 최대 3번까지 재시도합니다
- 특정 제품에서 실패하면 기록 후 다음 제품으로 넘어갑니다

---

## 📁 **Phase 2: 파일 정리 시스템**

### **파일 감지 및 분류**

#### **다운로드 폴더 모니터링**
1. `C:/Users/Administrator/Downloads/` 폴더를 5초마다 스캔합니다
2. 새로운 파일이 발견되면:
   - 파일명을 분석합니다
   - 파일 크기를 확인합니다
   - 생성 시간을 기록합니다

#### **파일명 패턴 분석**
**상세페이지 이미지 패턴:**
- 예시: `008 - 메모리폼 마우스 패드 _ 잘몬스터.png`
- 숫자 부분(`008 - `) 제거
- `_` 기준으로 분리: 제품명 / 브랜드명
- 결과: 제품명="메모리폼 마우스 패드", 브랜드명="잘몬스터"

**리뷰 데이터 패턴:**
- 예시: `review-naver-10315403710-202509111632.xlsx`
- 고정 형식으로 시간 정보만 추출

#### **순서 기반 매칭 (FIFO 큐)**
1. 상세페이지 이미지가 발견되면:
   - `pending_stores` 큐에 (브랜드명, 시간) 추가
2. 리뷰 엑셀이 발견되면:
   - `pending_stores`에서 가장 오래된 항목 꺼내기
   - 해당 브랜드와 매칭
3. 5분 이상 지난 대기 항목은 자동 정리

#### **파일 이동 및 정리**
1. 오늘 날짜 폴더 생성: `E:/업무/03_데이터_수집/20240916/`
2. 브랜드별 하위 폴더 생성: `잘몬스터_스토어/`
3. 매칭된 파일들을 해당 폴더로 이동
4. 중복 파일은 MD5 해시로 검사하여 제거

---

## 🧠 **Phase 3: AI 처리 시스템**

### **Stage 1: OCR 처리**

#### **이미지 준비**
1. `data/product_images/` 폴더의 모든 PNG 파일을 검색합니다
2. 각 이미지를 순서대로 로드합니다

#### **Tesseract OCR 실행**
1. Tesseract 실행 파일 경로 확인: `E:/Tesseract/tesseract.exe`
2. OCR 설정:
   - 언어: 한국어(kor) + 영어(eng)
   - PSM 모드: 6 (균일한 블록 텍스트)
   - OEM 모드: 3 (기본 + LSTM)
3. 이미지를 Tesseract로 전달하여 텍스트 추출
4. 추출된 텍스트를 `ocr_raw.jsonl` 파일에 저장

#### **OCR 후처리**
1. 불필요한 특수문자 제거
2. 중복 공백 정리
3. 가격 형식 정규화 (예: "30000원" → "30,000원")
4. 정리된 텍스트를 `ocr_clean.jsonl`에 저장

### **Stage 2: 구조화 및 콜드메일 생성**

#### **제품 정보 구조화**
1. Gemini API 초기화 (환경변수: VERTEX_PROJECT_ID)
2. `product_structuring.json` 프롬프트 로드
3. OCR 텍스트를 Gemini에 전달
4. 구조화된 정보 추출:
   - 제품명
   - 브랜드명
   - 가격
   - 주요 특징
   - 타겟 고객
5. 결과를 `product_structured.json`에 저장

#### **리뷰 데이터 분석**
1. `data/reviews/` 폴더의 엑셀 파일 로드
2. pandas로 데이터프레임 변환
3. 리뷰 분석:
   - 긍정/부정 비율
   - 자주 언급되는 키워드
   - 주요 불만사항
4. 결과를 `reviews_normalized.json`에 저장

#### **콜드메일 생성**
1. `cold_email.json` 프롬프트 로드
2. Gemini API 호출:
   - 입력: 구조화된 제품 정보 + 리뷰 분석
   - 온도: 0.3 (일관성 있는 출력)
   - 최대 토큰: 2048
3. 생성된 이메일 검증:
   - 350-600자 범위 확인
   - [광고] 접두사 확인
   - 민감 표현 제거
4. 최종 이메일을 `email_final.txt`에 저장

### **Stage 3: 정책 적용 및 최종 조립**

#### **민감 표현 처리**
- "치료" → "관리"
- "효능" → "도움"
- "완치" → "개선"
- 의료 관련 단정적 표현 모두 제거

#### **길이 조정**
- 350자 미만: 부가 설명 추가
- 600자 초과: 핵심만 남기고 축약

#### **최종 검증**
1. [광고] 접두사 확인
2. 글자 수 재확인
3. 금지어 최종 체크
4. 발송 가능 상태로 마킹

---

## 💾 **데이터베이스 관리**

### **엑셀 데이터베이스 구조**
파일 위치: `E:/업무/03_데이터_수집/이커머스_수집_데이터베이스.xlsx`

컬럼 구조:
- 수집일자: YYYY-MM-DD 형식
- 스토어명: 브랜드명
- 제품명: OCR에서 추출
- 제품URL: Step 1에서 수집
- 이메일주소: 수동 입력 필요
- 콜드메일발송: 대기/완료
- 응답상태: 대기/긍정/부정
- 기획안상태: 미작성/작성중/완료
- 예상수익: 50-200만원
- 상태: 진행 상태
- 메모: 특이사항

### **실시간 업데이트**
- 웹 자동화 완료 시: URL 즉시 기록
- 파일 정리 완료 시: 파일 경로 업데이트
- AI 처리 완료 시: 콜드메일 생성 완료 표시

---

## 🎮 **통합 GUI 인터페이스**

### **메인 윈도우 (900x700 픽셀)**

#### **상단 메뉴바**
- 파일: 설정 불러오기/저장
- 도구: 각 모듈 개별 실행
- 도움말: 사용법, 문제해결

#### **탭 시스템**
1. **웹 자동화 탭**
   - 제품 수 설정 (기본: 30개)
   - 진행 상황 프로그레스 바
   - 현재 처리 중인 제품 표시
   - 실패 목록 실시간 업데이트

2. **파일 정리 탭**
   - 파일 목록 트리뷰
   - 매칭 상태 표시
   - 수동 매칭 기능

3. **AI 처리 탭**
   - OCR 진행 상황
   - 콜드메일 생성 상태
   - 생성된 이메일 미리보기

4. **데이터베이스 탭**
   - 엑셀 데이터 실시간 표시
   - 필터링 및 검색
   - 통계 대시보드

#### **하단 상태바**
- 전체 진행률
- 현재 작업
- 남은 시간 예측
- 에러 카운트

### **핫키**
- F5: 전체 자동화 시작
- F6: 일시정지/재개
- ESC: 긴급 중단
- F9: 로그 보기

---

## 📂 **파일 및 폴더 구조**

### **메인 프로젝트 경로**
```
E:/VSC/all_in_one/all_in_one_new/all_in_one/
├── ultimate_automation_system.py      # 메인 통합 시스템
├── complete_automation_gui.py         # 완전 자동화 GUI
├── two_stage_gui.py                  # 2단계 분리 GUI
├── FileOrganizerGUI_new.py           # 파일 정리 시스템
├── config/
│   └── config.yaml                   # 시스템 설정
├── llm/
│   ├── gemini_client.py              # Gemini API 클라이언트
│   ├── two_stage_processor.py        # 2단계 처리기
│   └── prompts/
│       └── cold_email.json           # 콜드메일 프롬프트
├── compose/
│   └── email_sender_manager.py       # 이메일 발송 관리
├── data/
│   ├── product_images/              # 제품 이미지
│   └── reviews/                     # 리뷰 데이터
└── outputs/                         # 결과물
```

### **이미지 파일 경로**
```
E:/VSC/file_organizer/
├── detail_button.png              # 상세정보 버튼
├── fireshot_save.png              # 파이어샷 저장 버튼
├── review_button.png              # 리뷰 버튼
├── analysis_start.png             # 분석시작 버튼
├── excel_download.png             # 엑셀다운로드 버튼
├── popup_context.png              # 팝업 컨텍스트
├── review_context.png             # 리뷰 컨텍스트
└── result_context.png             # 결과 컨텍스트
```

### **업무 폴더 경로**
```
E:/업무/
├── 03_데이터_수집/
│   ├── 이커머스_수집_데이터베이스.xlsx
│   └── [날짜]/
│       └── [브랜드명]_스토어/
│           ├── 상세페이지.png
│           └── 리뷰데이터.xlsx
└── 04_콜드메일_관리/
    ├── 발송대기/
    └── 발송완료/
```

---

## 🔧 **환경 설정**

### **필수 설치 프로그램**
1. Python 3.8 이상
2. Tesseract OCR (E:/Tesseract/)
3. Chrome 브라우저
4. FireShot 확장프로그램
5. 이커머스AI솔루션 확장프로그램

### **Python 패키지**
```
google-generativeai>=0.3.0
pytesseract>=0.3.10
pandas>=1.5.0
openpyxl>=3.1.0
pyautogui>=0.9.54
pyperclip>=1.8.2
selenium>=4.15.0
pillow>=9.0.0
```

### **환경 변수**
```
VERTEX_PROJECT_ID=jadong-471919
TESSDATA_PREFIX=E:/Tesseract/tessdata
```

---

이것이 우리가 나눈 대화에서 추출한 완전 통합 자동화 시스템의 모든 내용입니다.